{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="moxheader"><a href="{% url 'hive:dashboard' %}"><img class="moximage" src="{% static 'hive/openmoxie_logo.svg' %}"></a>OpenMoxie<span class="moxversion">{{moxie_version}}</span></div>
{% if alert %}
    <div class="alert alert-primary">{{ alert }}</div>
{% endif %}
<div class="p-3">
<h2>Dispositivos</h2>
<a title="Código para mostrarle a Moxie cómo migrar a este servicio" class="btn btn-primary btn-sm" role="button" href="{% url 'hive:endpoint_qr' %}">Código QR de migración</a>
<a title="Crear un QR con credenciales WiFi para conectar a Moxie a una nueva red" class="btn btn-primary btn-sm" role="button" href="{% url 'hive:wifi_edit' %}">Código QR de WiFi</a>
<a title="Configurar el sistema" class="btn btn-secondary btn-sm" href="{% url 'hive:setup' %}">Configuración</a>
<a title="Administrar la base de datos" class="btn btn-secondary btn-sm" href="{% url 'admin:index' %}">Administración</a>
<table class="table table-striped">
  <tr><th class="w-25">Estado</th><th>Dispositivos Moxie</th><th>Horario</th><th>Acciones</th></tr>
  {% for device in recent_devices %}
  <tr><td>
    {% if device.device_id in live %}
    <span class="badge text-bg-success">En línea</span> {{device.last_connect|timesince}}
    {% else %}
    <span class="badge text-bg-secondary">Fuera de línea</span> {{device.last_disconnect|timesince}}
    {% endif %}
  </td><td><a href="{% url 'hive:moxie' device.pk %}">{{device}}</a>
    {% if not device.is_paired %}
    <span class="badge text-bg-danger">Sin emparejar</span>
    {% endif %}
  </td><td>{{device.schedule}}</td>
  <td>
    {% if device.robot_config.wake_button_enabled and device.device_id in live %}
    <a class="btn btn-success btn-sm" href="{% url 'hive:moxie_wake' device.pk %}">Despertar</a>
    {% endif %}
    <a title="Modificar misiones completadas o reiniciar el progreso del contenido" class="btn btn-secondary btn-sm" href="{% url 'hive:moxie_missions' device.pk %}">Misiones</a>
    <a title="Personalizar el rostro de Moxie" class="btn btn-secondary btn-sm" href="{% url 'hive:face' device.pk %}">Editar rostro</a>
    <a title="Teleoperar a Moxie" class="btn btn-secondary btn-sm" href="{% url 'hive:puppet' device.pk %}">Teleoperar</a>
    <a title="Ver datos persistentes de Moxie" class="btn btn-secondary btn-sm" href="{% url 'hive:moxie_data' device.pk %}">Datos</a>
  </td>
  </tr>
  {% endfor %}
</table>
<br>
<h2>Base de datos de contenido</h2>
<table class="table table-striped">
  <tr><th>Actualizar</th><td>
    <a title="Recargar cualquier entrada modificada en la vista de administración" class="btn btn-primary btn-sm" role="button" href="{% url 'hive:reload_database' %}">Actualizar desde la base de datos</a>
  </td></tr>
  <tr><th>Exportar</th><td>
    <a title="Exportar parte o todo tu contenido de Moxie" class="btn btn-primary btn-sm" role="button" href="{% url 'hive:export_content' %}">Exportar contenido</a>
  </td></tr>
  <tr><th>Importar</th><td>
    <form method="post" enctype="multipart/form-data" action="{% url 'hive:import_review' %}" method="post">
      {% csrf_token %}
      <div class="form-group">
        <input title="Selecciona un archivo JSON de contenido para subir" type="file" id="json_file" name="json_file" accept=".json" class="form-control-file">
        <button title="Sube contenido para revisarlo antes de añadirlo a tu Moxie" type="submit" class="btn btn-primary btn-sm">Subir para revisión</button>
      </div>
    </form>
  </td></tr>
</table>
<br>
<h2>Horarios</h2>
<table class="table table-striped">
  <tr><th>Nombre</th></tr>
  {% for s in schedules %}
  <tr><td>{{s.name}}</td></tr>
  {% endfor %}
</table>
<br>
<h2>Conversaciones</h2>
<table class="table table-striped">
  <tr><th>Nombre</th><th>ID de módulo</th><th>ID de contenido</th><th></th></tr>
  {% for s in conversations %}
  <tr><td>{{s}}</td><td>{{s.module_id}}</td><td>{{s.content_id}}</td><td><a href="{% url 'hive:interact' s.pk %}">Interactuar</a></td></tr>
  {% endfor %}
</table>
</div>
{% endblock %}